---
interface Props {
	firstName?: string;
	lastName?: string;
}

const { firstName = "ANIRUDDH", lastName = "SRIVASTAVA" } = Astro.props;
---

<div class="stroke-draw-name">
	<svg class="name-svg" viewBox="0 0 800 120" preserveAspectRatio="xMidYMid meet">
		<text class="name-text first-name" x="400" y="45" text-anchor="middle">
			{firstName.split('').map((letter, i) => (
				<tspan class="letter" style={`--letter-index: ${i}`}>{letter}</tspan>
			))}
		</text>
		<text class="name-text last-name" x="400" y="100" text-anchor="middle">
			{lastName.split('').map((letter, i) => (
				<tspan class="letter" style={`--letter-index: ${i + firstName.length}`}>{letter}</tspan>
			))}
		</text>
	</svg>
</div>

<script>
	function initStrokeAnimation() {
		const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
		const letters = document.querySelectorAll<SVGTSpanElement>('.stroke-draw-name .letter');

		letters.forEach((letter, index) => {
			// Get the computed length of the letter
			const textElement = letter.closest('text');
			if (!textElement) return;

			// Approximate letter width for stroke animation
			const letterWidth = 50; // Approximate stroke path length per letter

			letter.style.setProperty('--stroke-length', String(letterWidth));
			letter.style.setProperty('--letter-index', String(index));

			if (prefersReducedMotion) {
				letter.classList.add('no-animation');
			}
		});
	}

	// Run on page load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initStrokeAnimation);
	} else {
		initStrokeAnimation();
	}

	// Re-run on Astro page transitions
	document.addEventListener('astro:page-load', initStrokeAnimation);
</script>

<style>
	.stroke-draw-name {
		width: 100%;
		max-width: 800px;
		margin: 0 auto;
	}

	.name-svg {
		width: 100%;
		height: auto;
		overflow: visible;
	}

	.name-text {
		font-family: var(--font-brand);
		font-size: 48px;
		font-weight: 700;
		fill: transparent;
		stroke: var(--accent-regular);
		stroke-width: 1.5;
		stroke-linecap: round;
		stroke-linejoin: round;
	}

	.letter {
		stroke-dasharray: 100;
		stroke-dashoffset: 100;
		animation:
			draw-stroke 0.8s ease forwards,
			fill-in 0.4s ease forwards;
		animation-delay:
			calc(var(--letter-index) * 0.08s),
			calc(var(--letter-index) * 0.08s + 0.6s);
	}

	@keyframes draw-stroke {
		0% {
			stroke-dashoffset: 100;
			stroke: var(--accent-regular);
		}
		100% {
			stroke-dashoffset: 0;
			stroke: var(--accent-regular);
		}
	}

	@keyframes fill-in {
		0% {
			fill: transparent;
		}
		100% {
			fill: var(--gray-0);
			stroke: transparent;
		}
	}

	.letter.no-animation {
		animation: none;
		stroke-dashoffset: 0;
		fill: var(--gray-0);
		stroke: transparent;
	}

	@media (prefers-reduced-motion: reduce) {
		.letter {
			animation: none;
			stroke-dashoffset: 0;
			fill: var(--gray-0);
			stroke: transparent;
		}
	}

	@media (max-width: 50em) {
		.name-text {
			font-size: 36px;
		}

		.name-svg {
			viewBox: 0 0 600 100;
		}
	}

	@media (max-width: 30em) {
		.name-text.first-name {
			font-size: 28px;
		}

		.name-text.last-name {
			font-size: 24px;
		}
	}
</style>
